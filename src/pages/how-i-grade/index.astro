---
import { getContentPlainText, getPage } from "~/api/pages";
import AstroPageShell from "~/astro/AstroPageShell.astro";
import { Article } from "~/components/article/Article";
import { getProps } from "~/components/article/getArticleProps";
import { getLayoutBackdropImageProps } from "~/components/layout/getLayoutBackdropImageProps";
import { Layout } from "~/components/layout/Layout";

const { content, rawContent, title } = await getPage("how-i-grade");

const deck = `"Should I watch this movie?"`;

const props = await getProps({
  content,
});

const contextPlainText = getContentPlainText(rawContent);
const backdropImageProps = await getLayoutBackdropImageProps("how-i-grade");

//trim the string to the maximum length
var description = contextPlainText
  .replaceAll(/\r?\n|\r/g, " ")
  .slice(0, Math.max(0, 160));

//re-trim if we are in the middle of a word
description = description.slice(
  0,
  Math.max(0, Math.min(description.length, description.lastIndexOf(" "))),
);
---

<AstroPageShell
  canonical={true}
  meta={{ description }}
  openGraph={{ description: deck, type: "article" }}
  title={title}
>
  <Layout
    data-pagefind-body
    backdrop={{
      centerText: true,
      deck,
      imageProps: backdropImageProps,
      size: "large",
      title,
    }}
  >
    <Article {...props} />
  </Layout>
</AstroPageShell>
