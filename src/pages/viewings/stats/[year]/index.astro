---
import { allStatYears } from "~/api/stats";
import AstroPageShell from "~/astro/AstroPageShell.astro";
import { getLayoutBackdropImageProps } from "~/components/layout/getLayoutBackdropImageProps";
import { Layout } from "~/components/layout/Layout";
import { getYearStatsProps } from "~/features/stats/getStatsProps";
import { YearStats } from "~/features/stats/YearStats";

interface Props {
  year: string;
}

export async function getStaticPaths() {
  const statYears = await allStatYears();

  return statYears.map((year) => {
    return {
      params: {
        year: year,
      },
      props: {
        year: year,
      },
    };
  });
}

const { year } = Astro.props;

const yearStatsProps = await getYearStatsProps(year);
const backdropImageProps = await getLayoutBackdropImageProps(year);
const distinctStatYears = await allStatYears();

const deck =
  [...distinctStatYears].reverse()[0] === year
    ? "A Year in Progress..."
    : "A Year in Review";
const metaDescription = `My ${year} viewing stats. Includes my most-watched movies, directors, performers, and writers; as well as venue, release year, and media distributions.`;
---

<AstroPageShell
  canonical={true}
  meta={{ description: metaDescription }}
  openGraph={{
    description: deck,
    type: "website",
  }}
  title={`${year} Stats`}
>
  <Layout
    backdrop={{
      deck,
      breadcrumb: {
        href: "/viewings/",
        text: "Viewing Log",
      },
      imageProps: backdropImageProps,
      title: `${year} Stats`,
    }}
  >
    <YearStats {...yearStatsProps} />
  </Layout>
</AstroPageShell>
